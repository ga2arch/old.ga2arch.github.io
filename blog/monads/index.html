<!DOCTYPE html>
<html lang="en-US">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Dem Monads">

<base href="https://ga2arch.github.io/">
<title>


     Monads 

</title>
<link rel="canonical" href="https://ga2arch.github.io/blog/monads/">


<script type="text/javascript">
    var baseURL = 'https:\/\/ga2arch.github.io\/';
    var host = baseURL.substring(0, baseURL.length - 1).replace(/\//g, '');
    if ((host === window.location.host) && (window.location.protocol !== 'https:')) {
        window.location.protocol = 'https:';
    }
</script>





<link rel="stylesheet" href="https://ga2arch.github.io/css/reset.css">
<link rel="stylesheet" href="https://ga2arch.github.io/css/pygments.css">
<link rel="stylesheet" href="https://ga2arch.github.io/css/main.css">






<link rel="shortcut icon"

    href="https://ga2arch.github.io/img/favicon.ico"

>



</head>


<body lang="en">

<section class="header"> 
    <div class="container">
        <div class="content">
            <a href="https://ga2arch.github.io/"><div class="name">Gabriele Carrettoni</div></a>
            <nav>
                <ul>
                    <a href="https://ga2arch.github.io/blog/"><li>Blog</li></a>
                    <a href="https://ga2arch.github.io/about/"><li>About</li></a>
                    <a href="https://ga2arch.github.io/code/"><li>Code</li></a>
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">

        
            <a href="//github.com/ga2arch" target="_blank">
                <i class="icon ion-social-github"></i>
            </a>
        
        
        

        

        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    Monads

</div>

                    <div class="initials"><a href="https://ga2arch.github.io/"></a></div>
                </div>
                <div class="meta">
                    <div class="date" title="Sat Jan 16 2016 13:40:51 CET">Jan 16, 2016</div>
                    <div class="reading-time"><div class="middot"></div>3 minutes read</div>
                </div>
            </div>
            <div class="markdown">
                

<h2 id="monads:872cae6effde6b0736f0418affaaf91b">Monads</h2>

<p>Per spiegare cosa siano le monadi proverò a sviluppare l&rsquo;intuizione necessaria
per arrivare ad implementare la monade State.</p>

<p>Supponiamo di essere in un linguaggio puro, ovvero sia dove non è possibile
alterare il valore delle variabili una volta settate, poniamoci il problema di come trasportare lo stato da una funzione all&rsquo;altra:</p>

<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="nf">f</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span>
<span class="nf">f</span> <span class="n">name</span> <span class="n">counter</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;zap&quot;</span> 
  <span class="kr">then</span> <span class="p">(</span><span class="s">&quot;found&quot;</span><span class="p">,</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
  <span class="kr">else</span> <span class="p">(</span><span class="s">&quot;nada&quot;</span><span class="p">,</span>  <span class="n">counter</span><span class="p">)</span>

<span class="nf">g</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">g</span> <span class="n">counter</span> <span class="ow">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">3</span>
</code></pre></div>


<p>counter è il nostro stato, se volessimo passarlo da f a g dovremmo
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">let</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">counter1</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span> <span class="s">&quot;zap&quot;</span> <span class="mi">0</span>
<span class="kr">let</span> <span class="n">counter2</span> <span class="ow">=</span> <span class="n">g</span> <span class="n">counter1</span>
</code></pre></div>
</p>

<p>ogni funzione che vuol manipoalre lo stato dovrà prendere tutte le variabili che lo compongono e ricordarsi di ritornare all&rsquo;uscita della funzione stessa assieme a quello che la funzione ritornerebbe normalmente.</p>

<p>Come si nota la cosa non è molto comodo oltre al fatto che non è ben definita a livello di tipi.
Come procedere allora, prima cosa che si può fare è definire un record che definisca lo state da passare.</p>

<p><div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">data</span> <span class="kt">CounterState</span> <span class="ow">=</span> <span class="kt">CounterState</span> 
 <span class="p">{</span> <span class="n">counter</span> <span class="ow">::</span> <span class="kt">Int</span>
 <span class="p">}</span>
 
<span class="nf">f</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">CounterState</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">CounterState</span><span class="p">)</span>
<span class="nf">f</span> <span class="n">name</span> <span class="n">st</span><span class="o">@</span><span class="p">(</span><span class="kt">CounterState</span> <span class="n">counter</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;zap&quot;</span>
  <span class="kr">then</span> <span class="p">(</span><span class="s">&quot;found&quot;</span><span class="p">,</span> <span class="n">st</span><span class="p">{</span><span class="n">counter</span> <span class="ow">=</span> <span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span>
  <span class="kr">else</span> <span class="p">(</span><span class="s">&quot;nada&quot;</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span>

<span class="nf">g</span> <span class="ow">::</span> <span class="kt">CounterState</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="nb">()</span><span class="p">,</span> <span class="kt">CounterState</span><span class="p">)</span>
<span class="nf">g</span> <span class="n">st</span><span class="o">@</span><span class="p">(</span><span class="kt">CounterState</span> <span class="n">counter</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="nb">()</span><span class="p">,</span> <span class="n">st</span><span class="p">{</span><span class="n">counter</span> <span class="ow">=</span> <span class="n">counter</span><span class="o">+</span><span class="mi">3</span><span class="p">})</span>

<span class="kr">let</span> <span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="n">st1</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span> <span class="s">&quot;zap&quot;</span> <span class="p">(</span><span class="kt">CounterState</span> <span class="mi">0</span><span class="p">)</span>
<span class="kr">let</span> <span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="n">st2</span><span class="p">)</span> <span class="ow">=</span> <span class="n">g</span> <span class="n">st1</span>
</code></pre></div>
</p>

<p>Già va meglio, si può vedere che ora g accetta solo CounterState, ma c&rsquo;è sempre bisogno di ricordarsi di ritornare lo state e nonstante entrambe le funzioni lavorino sul medesimo stato non sono componibili direttamente, c&rsquo;è sempre bisogno di spacchettare result e state e passare lo state alla nuova funzione.</p>

<p>Ora se analiziamo il tipo di (f &ldquo;zap&rdquo;) e g noteremo che è</p>

<p><code>s -&gt; (a, s)</code></p>

<p>overro preso uno state s, ritorna una tupla con il result e lo state.</p>

<p>Creiamo allora un record per questa funzione:</p>

<p><div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">data</span> <span class="kt">State</span> <span class="n">s</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">State</span> <span class="p">{</span> <span class="n">unState</span> <span class="ow">::</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">}</span>

<span class="nf">f</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">State</span> <span class="kt">CounterState</span> <span class="kt">String</span> 
<span class="nf">f</span> <span class="n">name</span> <span class="ow">=</span> <span class="kt">State</span> <span class="p">(</span><span class="nf">\</span><span class="n">st</span><span class="o">@</span><span class="p">(</span><span class="kt">CounterState</span> <span class="n">counter</span><span class="p">)</span> <span class="ow">-&gt;</span> 
  <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;zap&quot;</span>
    <span class="kr">then</span> <span class="p">(</span><span class="s">&quot;found&quot;</span><span class="p">,</span> <span class="n">st</span><span class="p">{</span><span class="n">counter</span><span class="ow">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">}))</span>
    <span class="kr">else</span> <span class="p">(</span><span class="s">&quot;nada&quot;</span> <span class="p">,</span> <span class="n">st</span><span class="p">)</span>

<span class="nf">g</span> <span class="ow">::</span> <span class="kt">State</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">State</span> <span class="kt">CounterState</span> <span class="nb">()</span>
<span class="nf">g</span> <span class="ow">=</span> <span class="kt">State</span> <span class="p">(</span><span class="nf">\</span><span class="n">st</span><span class="o">@</span><span class="p">(</span><span class="kt">CounterState</span> <span class="n">counter</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="nb">()</span><span class="p">,</span> <span class="n">st</span><span class="p">{</span><span class="n">counter</span><span class="ow">=</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">}))</span>

<span class="kr">let</span> <span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="n">st1</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">unState</span> <span class="p">(</span><span class="n">f</span> <span class="s">&quot;zap&quot;</span><span class="p">))</span> <span class="p">(</span><span class="kt">CounterState</span> <span class="mi">0</span><span class="p">)</span>
<span class="kr">let</span> <span class="p">(</span><span class="n">result2</span><span class="p">,</span> <span class="n">st2</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">unState</span> <span class="n">g</span><span class="p">)</span> <span class="n">st1</span>
</code></pre></div>
</p>

<p>Abbiamo &ldquo;wrappato&rdquo; le due funzioni e messe all&rsquo;interno del record State e chiamare <em>unState</em> sul record <em>State</em> ci permette di estrarre la funzione e di chiamarla poi passandoci lo stato o argomenti aggiuntivi.</p>

<p>Guardandi attentamente il tipo di ritorno di entrambe le funzioni notiamo che <em>State CounterState</em> è costante, cambia solo il tipo di ritorno, quindi se assegniamo</p>

<pre><code>m = State CounterState
</code></pre>

<p>possiamo riscrivere le signature</p>

<pre><code>f :: String -&gt; m String
g :: m ()
</code></pre>

<p>Ora vogliamo affrontare il problema di comporre queste due funzioni e qui entrano in campo le Monadi.
Un monad è definita come</p>

<p><div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">class</span> <span class="kt">Monad</span> <span class="kr">where</span>
  <span class="n">return</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">a</span>
  <span class="p">(</span><span class="o">&gt;&gt;=</span><span class="p">)</span> <span class="ow">::</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span>
</code></pre></div>
</p>

                <br>
                <p><a href="https://ga2arch.github.io/blog/">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                
            </div>
        </div>
    </div>
</section>





</body>
</html>

